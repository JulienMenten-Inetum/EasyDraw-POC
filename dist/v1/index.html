<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>EasyDraw v1</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"
    />
    <style type="text/css">
      body {
        font-family: Arial;
      }
      .dimension_text {
        position: absolute;
        top: 20px;
        left: 70px;
      }
      .dimension_text input {
        height: 50px;
        font-size: 30px;
        width: 150px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div id="drawing-tool"></div>
    </div>
    <div
      id="dimension_text_div_id"
      class="dimension_text"
      style="display: none"
    >
      <input id="dimension_text_id" />
    </div>
    <div class="color-picker" style="display: none"></div>
    <!--        <div id="buttons">-->
    <!--            <button id="clear">Clear</button>-->
    <!--            <button id="save">Save</button>-->
    <!--            <button id="load">Load</button>-->
    <!--            <input type="text" id="doorcolor" /><button id="doorcolor-btn">Change</button>-->
    <!--            <div id="test"></div>-->
    <!--            <button id="svg">svg</button>-->
    <!--            <button id="picture">picture</button>-->
    <!--            <input id="pdf" type="file" />-->
    <!--            <input id="straight_angle" value="3" />-->
    <!--        </div>-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/1.5.0/fabric.js"></script>
    <link type="text/css" rel="stylesheet" href="../drawing-tool.css" />
    <script src="../drawing-tool.js"></script>
    <script type="text/javascript" src="PDF.js"></script>

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/themes/nano.min.css"
    />

    <script>
      var my_state = {
        version: 1,
        dt: {
          width: 800,
          height: 603,
        },
        canvas: {
          version: "3.6.3",
          objects: [
            {
              type: "path",
              version: "3.6.3",
              originX: "left",
              originY: "top",
              left: -142.5,
              top: -312.5,
              width: 284,
              height: 624,
              fill: "#24353f",
              stroke: null,
              strokeWidth: 1,
              strokeDashArray: null,
              strokeLineCap: "butt",
              strokeDashOffset: 0,
              strokeLineJoin: "miter",
              strokeMiterLimit: 4,
              scaleX: 1,
              scaleY: 1,
              angle: 0,
              flipX: false,
              flipY: false,
              opacity: 1,
              shadow: null,
              visible: true,
              clipTo: null,
              backgroundColor: "",
              fillRule: "nonzero",
              paintFirst: "fill",
              globalCompositeOperation: "source-over",
              transformMatrix: null,
              skewX: 0,
              skewY: 0,
              lockUniScaling: false,
              objectCaching: true,
              path: [["M", 28, 28], ["h", 284], ["v", 624], ["H", 28], ["z"]],
            },
            {
              type: "path",
              version: "3.6.3",
              originX: "left",
              originY: "top",
              left: -170.5,
              top: -340.5,
              width: 340,
              height: 680,
              fill: "",
              stroke: null,
              strokeWidth: 1,
              strokeDashArray: null,
              strokeLineCap: "butt",
              strokeDashOffset: 0,
              strokeLineJoin: "miter",
              strokeMiterLimit: 4,
              scaleX: 1,
              scaleY: 1,
              angle: 0,
              flipX: false,
              flipY: false,
              opacity: 1,
              shadow: null,
              visible: true,
              clipTo: null,
              backgroundColor: "",
              fillRule: "nonzero",
              paintFirst: "fill",
              globalCompositeOperation: "source-over",
              transformMatrix: null,
              skewX: 0,
              skewY: 0,
              lockUniScaling: false,
              objectCaching: true,
              path: [["M", 0, 0], ["h", 340], ["v", 680], ["H", 0], ["z"]],
            },
            {
              type: "path",
              version: "3.6.3",
              originX: "left",
              originY: "top",
              left: -141.5,
              top: -311.5,
              width: 281,
              height: 621,
              fill: "",
              stroke: "#000",
              strokeWidth: 3,
              strokeDashArray: null,
              strokeLineCap: "butt",
              strokeDashOffset: 0,
              strokeLineJoin: "miter",
              strokeMiterLimit: 4,
              scaleX: 1,
              scaleY: 1,
              angle: 0,
              flipX: false,
              flipY: false,
              opacity: 1,
              shadow: null,
              visible: true,
              clipTo: null,
              backgroundColor: "",
              fillRule: "nonzero",
              paintFirst: "fill",
              globalCompositeOperation: "source-over",
              transformMatrix: null,
              skewX: 0,
              skewY: 0,
              lockUniScaling: false,
              objectCaching: true,
              path: [["M", 30, 30], ["h", 281], ["v", 621], ["H", 30], ["z"]],
            },
            {
              type: "path",
              version: "3.6.3",
              originX: "left",
              originY: "top",
              left: -130.5,
              top: -300.5,
              width: 258,
              height: 598,
              fill: "",
              stroke: "#000",
              strokeWidth: 3,
              strokeDashArray: null,
              strokeLineCap: "butt",
              strokeDashOffset: 0,
              strokeLineJoin: "miter",
              strokeMiterLimit: 4,
              scaleX: 1,
              scaleY: 1,
              angle: 0,
              flipX: false,
              flipY: false,
              opacity: 1,
              shadow: null,
              visible: true,
              clipTo: null,
              backgroundColor: "",
              fillRule: "nonzero",
              paintFirst: "fill",
              globalCompositeOperation: "source-over",
              transformMatrix: null,
              skewX: 0,
              skewY: 0,
              lockUniScaling: false,
              objectCaching: true,
              path: [["M", 41, 41], ["h", 258], ["v", 598], ["H", 41], ["z"]],
            },
            {
              type: "path",
              version: "3.6.3",
              originX: "left",
              originY: "top",
              left: -383.06,
              top: 0.71,
              width: 429,
              height: 429,
              fill: {
                type: "linear",
                coords: {
                  x1: 0,
                  y1: 680.3,
                  x2: 1,
                  y2: 680.3,
                },
                colorStops: [
                  {
                    offset: 1,
                    color: "rgb(234,246,254)",
                    opacity: 1,
                  },
                  {
                    offset: 0.7,
                    color: "rgb(202,227,246)",
                    opacity: 1,
                  },
                  {
                    offset: 0.1,
                    color: "rgb(123,182,227)",
                    opacity: 1,
                  },
                  {
                    offset: 0,
                    color: "rgb(105,172,223)",
                    opacity: 1,
                  },
                  {
                    offset: 0,
                    color: "rgb(105,172,223)",
                    opacity: 1,
                  },
                ],
                offsetX: 124,
                offsetY: -126,
                gradientUnits: "pixels",
                gradientTransform: [0, 433, 433, 0, -294341, 124],
              },
              stroke: null,
              strokeWidth: 1,
              strokeDashArray: null,
              strokeLineCap: "butt",
              strokeDashOffset: 0,
              strokeLineJoin: "miter",
              strokeMiterLimit: 4,
              scaleX: 1,
              scaleY: 1,
              angle: -45,
              flipX: false,
              flipY: false,
              opacity: 1,
              shadow: null,
              visible: true,
              clipTo: null,
              backgroundColor: "",
              fillRule: "nonzero",
              paintFirst: "fill",
              globalCompositeOperation: "source-over",
              transformMatrix: null,
              skewX: 0,
              skewY: 0,
              clipPath: {
                type: "path",
                version: "3.6.3",
                originX: "left",
                originY: "top",
                left: 176.57,
                top: -215.46,
                width: 54,
                height: 553,
                fill: "rgb(0,0,0)",
                stroke: null,
                strokeWidth: 1,
                strokeDashArray: null,
                strokeLineCap: "butt",
                strokeDashOffset: 0,
                strokeLineJoin: "miter",
                strokeMiterLimit: 4,
                scaleX: 1,
                scaleY: 1,
                angle: 45,
                flipX: false,
                flipY: false,
                opacity: 1,
                shadow: null,
                visible: true,
                clipTo: null,
                backgroundColor: "",
                paintFirst: "fill",
                globalCompositeOperation: "source-over",
                transformMatrix: null,
                skewX: 0,
                skewY: 0,
                lockUniScaling: false,
                objectCaching: true,
                path: [["M", 64, 64], ["h", 54], ["v", 553], ["H", 64], ["z"]],
                inverted: false,
                absolutePositioned: false,
              },
              lockUniScaling: false,
              objectCaching: true,
              path: [
                ["M", -124, 126],
                ["h", 429],
                ["v", 429],
                ["h", -429],
                ["z"],
              ],
            },
            {
              type: "path",
              version: "3.6.3",
              originX: "left",
              originY: "top",
              left: -107.5,
              top: -277.5,
              width: 212,
              height: 553,
              fill: "",
              stroke: "#000",
              strokeWidth: 3,
              strokeDashArray: null,
              strokeLineCap: "butt",
              strokeDashOffset: 0,
              strokeLineJoin: "miter",
              strokeMiterLimit: 4,
              scaleX: 1,
              scaleY: 1,
              angle: 0,
              flipX: false,
              flipY: false,
              opacity: 1,
              shadow: null,
              visible: true,
              clipTo: null,
              backgroundColor: "",
              fillRule: "nonzero",
              paintFirst: "fill",
              globalCompositeOperation: "source-over",
              transformMatrix: null,
              skewX: 0,
              skewY: 0,
              lockUniScaling: false,
              objectCaching: true,
              path: [
                ["M", 64, 64],
                ["h", 54],
                ["v", 553],
                ["H", 64],
                ["z"],
                ["M", 143, 64],
                ["h", 133],
                ["v", 553],
                ["H", 143],
                ["z"],
              ],
            },
            {
              type: "path",
              version: "3.6.3",
              originX: "left",
              originY: "top",
              left: -139.5,
              top: -307.5,
              width: 277,
              height: 616,
              fill: "",
              stroke: "#777776",
              strokeWidth: 1,
              strokeDashArray: [0, 0, 4, 4],
              strokeLineCap: "butt",
              strokeDashOffset: 0,
              strokeLineJoin: "miter",
              strokeMiterLimit: 4,
              scaleX: 1,
              scaleY: 1,
              angle: 0,
              flipX: false,
              flipY: false,
              opacity: 1,
              shadow: null,
              visible: true,
              clipTo: null,
              backgroundColor: "",
              fillRule: "nonzero",
              paintFirst: "fill",
              globalCompositeOperation: "source-over",
              transformMatrix: null,
              skewX: 0,
              skewY: 0,
              lockUniScaling: false,
              objectCaching: true,
              path: [
                ["m", 36, 33],
                ["l", 272, 303],
                ["M", 307, 343],
                ["L", 31, 649],
              ],
            },
            {
              type: "path",
              version: "3.6.3",
              originX: "left",
              originY: "top",
              left: -141.5,
              top: -311.5,
              width: 282,
              height: 623,
              fill: "",
              stroke: "#777776",
              strokeWidth: 1,
              strokeDashArray: null,
              strokeLineCap: "butt",
              strokeDashOffset: 0,
              strokeLineJoin: "miter",
              strokeMiterLimit: 4,
              scaleX: 1,
              scaleY: 1,
              angle: 0,
              flipX: false,
              flipY: false,
              opacity: 1,
              shadow: null,
              visible: true,
              clipTo: null,
              backgroundColor: "",
              fillRule: "nonzero",
              paintFirst: "fill",
              globalCompositeOperation: "source-over",
              transformMatrix: null,
              skewX: 0,
              skewY: 0,
              lockUniScaling: false,
              objectCaching: true,
              path: [
                ["m", 30, 650],
                ["l", -1, 2],
                ["m", 281, -315],
                ["l", 1, 2],
                ["l", -1, 1],
                ["M", 32, 29],
                ["l", 1, 1],
              ],
            },
          ],
          background: "#fff",
        },
      };
      //$('#doorcolor').val(my_state.canvas.objects[0].objects[0].fill);
      pdfjsLib.GlobalWorkerOptions.workerSrc = "PDFworker.js";
    </script>
    <script>
      var drawingTool = new DrawingTool("#drawing-tool", {
        stamps: {
          Doors: ["door.svg"],
          Templates: [
            "arduin_dorpel_met_opkant.png",
            "arduin_dorpel_zonder_opkant.png",
            "template1.png",
            "templates connect inmeten VD BL.jpg",
            "templates connect inmeten VD ST.jpg",
            "Verticaal detail dorpel met opkant.png",
            "Verticaal detail dorpel zonder opkant.png",
            "T-stijl.svg",
            "Hoekstijl.svg",
            "horizontaal_detail.png",
          ],
          Checkboxes: [
            "checkbox_on60.svg",
            "checkbox_off60.svg",
            "checkbox_on80.svg",
            "checkbox_off80.svg",
            "checkbox_on100.svg",
            "checkbox_off100.svg",
            "checkbox_on120.svg",
            "checkbox_off120.svg",
            "checkbox_on140.svg",
            "checkbox_off140.svg",
          ],
          Extra: ["heart.svg"],
        },
        parseSVG: true,
        separatorsAfter: ["stamp", "strokeWidthPalette"],
      });
      var state = null;
      $("#dimension_text_id").on("keyup", function () {
        drawingTool.setDimensionText($("#dimension_text_id").val());
      });
      $("#set-background").on("click", function () {
        drawingTool.setBackgroundImage($("#background-src").val());
      });
      $("#resize-background").on("click", function () {
        drawingTool.resizeBackgroundToCanvas();
      });
      $("#resize-canvas").on("click", function () {
        drawingTool.resizeCanvasToBackground();
      });
      $("#shrink-background").on("click", function () {
        drawingTool.shrinkBackgroundToCanvas();
      });
      $("#clear").on("click", function () {
        // drawingTool.clear(true);
        drawingTool.clear(false); // don't remove the background
      });
      $("#save").on("click", function () {
        state = drawingTool.save();
        console.log(state);
        $("#load").removeAttr("disabled");
      });
      $("#load").on("click", function () {
        if (state === null) return;
        drawingTool.load(state);
      });

      $("#doorcolor-btn").on("click", function (e) {
        //my_state.canvas.objects[0].objects[0].fill = $('#doorcolor').val();
        //state = drawingTool.save();
        drawingTool.load(my_state);
        //drawingTool.load(state);
      });
      $("#ungroup").click(function () {
        drawingTool.unGroup();
      });

      $("#gradient").click(function () {
        drawingTool.fillGradient("#000000", "#ffffff");
      });

      $("#picture").click(function () {
        drawingTool.loadImage("picture.png");
      });
      $("#pdf").on("change", function (event) {
        var file = event.target.files[0];
        var fileReader = new FileReader();

        fileReader.onload = function () {
          var typedarray = new Uint8Array(this.result);
          pdfjsLib.workerSrc = "pdf.worker.js";

          var loadingTask = pdfjsLib.getDocument(typedarray);
          loadingTask.promise.then(function (pdf) {
            // you can now use *pdf* here
            pdf.getPage(1).then(function (page) {
              // you can now use *page* here
              var viewport = page.getViewport({ scale: 2 });
              var canvas = document.createElement("canvas");

              canvas.height = viewport.height;
              canvas.width = viewport.width;
              canvas.style.visibility = "hidden";

              var renderTask = page.render({
                canvasContext: canvas.getContext("2d"),
                viewport: viewport,
              });

              renderTask.promise.then(function () {
                let image = canvas.toDataURL();
                canvas.height = 0;
                canvas.width = 0;
                fabric.Image.fromURL(image, function (img) {
                  var widthRatio = my_state.dt.width / img.width;
                  var heightRatio = my_state.dt.height / img.height;
                  var minRatio = Math.min(widthRatio, heightRatio);
                  // fabric.log(my_state.dt.width);
                  // fabric.log(widthRatio);
                  // fabric.log(my_state.dt.height);
                  // fabric.log(heightRatio);
                  if (minRatio < 1) {
                    img.set({
                      // width: img.width * minRatio,
                      // height: img.height * minRatio,
                      scaleX: minRatio,
                      scaleY: minRatio,
                    });
                  }
                  var posX = my_state.dt.width;
                  var posY = 0;

                  posX = posX - img.width / 2;

                  img.set({ left: posX, top: posY });

                  drawingTool.canvas.add(img);
                  drawingTool.pushToHistory();
                  drawingTool.chooseTool("select");
                });
              });
            });
          });
        };

        fileReader.readAsArrayBuffer(file);
      });

      // limit zooming to the canvas only
      const easydrawCanvas =
        document.getElementsByClassName("canvas-container")[0];
      var in_zoom_pan = false;
      var x0, y0;

      easydrawCanvas.addEventListener("wheel", (event) => {
        event.preventDefault();
        event.stopPropagation();
        var delta = event.deltaY;
        var zoom = drawingTool.canvas.getZoom();
        if (!!zoom) {
          zoom = zoom + delta / 200;
          if (zoom > 20) zoom = 20;
          // if (zoom < 0.01) zoom = 0.01; // original
          if (zoom < 1) zoom = 1; // disabled zooming out, not used in Connect
          drawingTool.canvas.zoomToPoint(
            { x: event.offsetX, y: event.offsetY },
            zoom
          );
        }
      });
      easydrawCanvas.addEventListener("gesturestart", (event) => {
        // event.preventDefault();
        // event.stopPropagation();
        // console.log(event)
        x0 = event.screenX;
        y0 = event.screenY;
        drawingTool.currentTool.setActive(false);
        drawingTool.undo();
        drawingTool.redo();
        in_zoom_pan = true;
      });

      easydrawCanvas.addEventListener("gesturechange", (event) => {
        event.preventDefault();
        event.stopPropagation();
        var delta = event.deltaY;
        var zoom = drawingTool.canvas.getZoom();
        var scale = 1;
        if (zoom.isNaN) {
          zoom = zoom + delta / 20;
          if (zoom > 20) zoom = 20;
          // if (zoom < 0.01) zoom = 0.01; // original
          if (zoom < 1) zoom = 1; // disabled zooming out, not used in Connect
          drawingTool.canvas.zoomToPoint(
            { x: event.offsetX, y: event.offsetY },
            zoom
          );
        } else {
          scale = event.scale;
          drawingTool.canvas.zoomToPoint(
            { x: event.layerX, y: event.layerY },
            scale
          );
          var x = event.screenX,
            y = event.screenY;
          drawingTool.canvas.relativePan({ x: x - x0, y: y - y0 });
          x0 = x;
          y0 = y;
        }
        drawingTool.startPan(event, drawingTool.canvas, true);
      });

      // easydrawCanvas.addEventListener("wheel", (event) => {
      //     event.preventDefault();
      //     const scale = 2;
      //     var offsetX = (event.clientX - drawingTool.canvas._offset.left) / scale;
      //     var offsetY = (event.clientY - drawingTool.canvas._offset.top) / scale;
      //     if (event.clientX / scale > drawingTool.canvas._offset.left && event.clientY / scale > drawingTool.canvas._offset.top && event.clientX / scale < drawingTool.canvas._offset.left + drawingTool.canvas.width && event.clientY / scale < drawingTool.canvas._offset.top + drawingTool.canvas.height) {
      //         var delta = event.deltaY * -1; // disable this -1 for 'natural zoom'
      //         var zoom = drawingTool.canvas.getZoom();
      //         zoom = zoom + delta / 200;
      //         if (zoom > 10) zoom = 10;
      //         if (zoom < 0) zoom = 0;
      //         fabric.log('zoom',zoom)
      //         if (delta > 0) {
      //             drawingTool.canvas.zoomToPoint({ x: offsetX, y: offsetY }, zoom);
      //             console.log(offsetX, offsetY, drawingTool.canvas.viewportTransform[4], drawingTool.canvas.viewportTransform[0]);
      //         } else {
      //             drawingTool.canvas.zoomToPoint({ x: offsetX, y: offsetY }, zoom);
      //             if (drawingTool.canvas.viewportTransform[4] > 0) {
      //                 drawingTool.canvas.viewportTransform[4] = 0;
      //             }
      //             if (drawingTool.canvas.viewportTransform[5] > 0) {
      //                 drawingTool.canvas.viewportTransform[5] = 0;
      //             }
      //             if (drawingTool.canvas.viewportTransform[4] < drawingTool.canvas.width - drawingTool.canvas.width * zoom) {
      //                 drawingTool.canvas.viewportTransform[4] = drawingTool.canvas.width - drawingTool.canvas.width * zoom;
      //             }
      //             if (drawingTool.canvas.viewportTransform[5] < drawingTool.canvas.height - drawingTool.canvas.height * zoom) {
      //                 drawingTool.canvas.viewportTransform[5] = drawingTool.canvas.height - drawingTool.canvas.height * zoom;
      //             }
      //         }
      //         event.stopPropagation();
      //     }
      // });

      // easydrawCanvas.addEventListener(
      //     "gesturechange",
      //     (event) => {
      //         event.preventDefault();
      //         var panX;
      //         var panY;
      //
      //         const scale = 2;
      //         var offsetX = (event.clientX - drawingTool.canvas._offset.left) / scale;
      //         var offsetY = (event.clientY - drawingTool.canvas._offset.top) / scale;
      //
      //         if (panX == "" && panY == "") {
      //             panX = event.clientX / scale;
      //             panY = event.clientY / scale;
      //         } else {
      //             var panDeltaX = panX - event.clientX / scale;
      //             var panDeltaY = panY - event.clientY / scale;
      //             drawingTool.canvas.viewportTransform[4] = drawingTool.canvas.viewportTransform[4] - panDeltaX;
      //             drawingTool.canvas.viewportTransform[5] = drawingTool.canvas.viewportTransform[5] - panDeltaY;
      //             panX = event.clientX / scale;
      //             panY = event.clientY / scale;
      //         }
      //
      //         if (event.clientX / scale > drawingTool.canvas._offset.left && event.clientY / scale > drawingTool.canvas._offset.top && event.clientX / scale < drawingTool.canvas._offset.left + drawingTool.canvas.width && event.clientY / scale < drawingTool.canvas._offset.top + drawingTool.canvas.height) {
      //             var zoom = 100 * event.scale;
      //             if (zoom > 10) zoom = 10;
      //             if (zoom < 1) zoom = 1;
      //
      //             drawingTool.canvas.zoomToPoint({ x: offsetX, y: offsetY }, zoom);
      //             if (drawingTool.canvas.viewportTransform[4] > 0) {
      //                 drawingTool.canvas.viewportTransform[4] = 0;
      //             }
      //             if (drawingTool.canvas.viewportTransform[5] > 0) {
      //                 drawingTool.canvas.viewportTransform[5] = 0;
      //             }
      //             if (drawingTool.canvas.viewportTransform[4] < drawingTool.canvas.width - drawingTool.canvas.width * zoom) {
      //                 drawingTool.canvas.viewportTransform[4] = drawingTool.canvas.width - drawingTool.canvas.width * zoom;
      //             }
      //             if (drawingTool.canvas.viewportTransform[5] < drawingTool.canvas.height - drawingTool.canvas.height * zoom) {
      //                 drawingTool.canvas.viewportTransform[5] = drawingTool.canvas.height - drawingTool.canvas.height * zoom;
      //             }
      //
      //             event.stopPropagation();
      //         }
      //     },
      //     { passive: false }
      // );
      window.addEventListener(
        "gestureend",
        function (e) {
          in_zoom_pan = false;
          var panX = "";
          var panY = "";

          drawingTool.currentTool.setActive(true);
        },
        { passive: false }
      );

      // Prevents window from moving on touch on newer browsers.
      document.addEventListener(
        "touchmove",
        function (event) {
          console.log("touchmove");
          if (in_zoom_pan) {
            event.preventDefault();
            event.stopImmediatePropagation();
          } else {
            if (drawingTool.currentTool.name == "Pan Tool") {
              event.preventDefault();
              event.stopImmediatePropagation();
              if (!!event.touches) {
                var x = event.touches[0].screenX,
                  y = event.touches[0].screenY;
                console.log(x, y);
                drawingTool.canvas.relativePan({
                  x: x - lastPosX,
                  y: y - lastPosY,
                });
                lastPosX = x;
                lastPosY = y;
              }
            }
          }
        },
        { passive: false }
      );
      document.addEventListener("touchstart", function (event) {
        console.log("touchstart");
        if (in_zoom_pan) {
          event.preventDefault();
          event.stopPropagation();
        } else {
          if (drawingTool.currentTool.name == "Pan Tool") {
            event.preventDefault();
            event.stopPropagation();
            if (!!event.touches) {
              (lastPosX = event.touches[0].screenX),
                (lastPosY = event.touches[0].screenY);
            }
          }
        }
      });

      // FIX issue where canvas loads in empty in FileMaker
      window.onload = function () {
        drawingTool.undo();
        drawingTool.redo();
        drawingTool.resetHistory();
      };

      // canvas resizing
      const onResize = () => {
        drawingTool.canvas.setDimensions({
          width: window.innerWidth - 60,
          height: window.innerHeight - 20,
        });
        // update devicePixelRatio
        fabric.devicePixelRatio =
          fabric.window.devicePixelRatio ||
          fabric.window.webkitDevicePixelRatio ||
          fabric.window.mozDevicePixelRatio ||
          1;
        drawingTool.canvas._initRetinaScaling();

        // re-render canvas with new quality
        drawingTool.canvas.requestRenderAll();
      };

      window.addEventListener("resize", onResize);
      window.addEventListener("load", onResize);

      // Create new DrawingTool
    </script>
  </body>
</html>
